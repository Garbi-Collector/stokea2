<div class="venta-container">
  <!-- Header -->
  <div class="header-section">
    <div>
      <h1 class="page-title">Nueva Venta</h1>
      <p class="page-subtitle">Escanea o ingresa el código del producto</p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="content-grid">
    <!-- Left Panel - Product Search and Details -->
    <div class="product-panel">
      <div class="search-card">
        <h2 class="card-title">Producto</h2>

        <!-- Product Code Input -->
        <div class="form-group">
          <label for="productCode" class="form-label">Código del Producto</label>
          <div class="input-wrapper">
            <input
              #codeInput
              type="text"
              id="productCode"
              class="form-input code-input"
              placeholder="Escanea o escribe el código..."
              [(ngModel)]="productCode"
              (ngModelChange)="onCodeChange()"
              [disabled]="isLoading"
            />
            <svg *ngIf="isLoading" class="input-icon spinning" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
            </svg>
            <svg *ngIf="!isLoading && currentProduct" class="input-icon success" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          </div>
          <p *ngIf="productNotFound" class="error-message">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            Producto no encontrado
          </p>
        </div>

        <!-- Product Name Input (Alternative Search) -->
        <div class="form-group">
          <label for="productName" class="form-label">Nombre del Producto</label>
          <input
            type="text"
            id="productName"
            class="form-input"
            placeholder="Buscar por nombre..."
            [(ngModel)]="productName"
            (ngModelChange)="onNameChange()"
            [disabled]="isLoading || !!currentProduct"
          />
        </div>

        <!-- Product Details (Read-only when product is loaded) -->
        <div class="details-grid">
          <div class="form-group">
            <label class="form-label">Marca</label>
            <input
              type="text"
              class="form-input"
              [value]="brand"
              readonly
            />
          </div>

          <div class="form-group">
            <label class="form-label">Precio de Venta</label>
            <div class="price-display">
              <span class="currency">$</span>
              <span class="amount">{{ salePrice | number:'1.2-2' }}</span>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Stock Disponible</label>
            <div class="stock-display" [class.low-stock]="stockQuantity > 0 && stockQuantity <= 10" [class.no-stock]="stockQuantity === 0">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                <line x1="12" y1="22.08" x2="12" y2="12"></line>
              </svg>
              <span class="stock-number">{{ stockQuantity }}</span>
              <span class="stock-label">unidades</span>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Cantidad a Vender</label>
            <input
              type="number"
              class="form-input quantity-input"
              [(ngModel)]="quantityToAdd"
              min="1"
              [max]="stockQuantity"
              [disabled]="!currentProduct || stockQuantity === 0"
            />
          </div>
        </div>

        <!-- Description -->
        <div class="form-group" *ngIf="description">
          <label class="form-label">Descripción</label>
          <div class="description-box">
            {{ description }}
          </div>
        </div>

        <!-- Add to Cart Button -->
        <button
          class="add-to-cart-button"
          (click)="addToCart()"
          [disabled]="!currentProduct || stockQuantity === 0 || quantityToAdd <= 0"
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
          Agregar al Carrito
        </button>
      </div>
    </div>

    <!-- Right Panel - Shopping Cart -->
    <div class="cart-panel">
      <div class="cart-card">
        <div class="cart-header">
          <h2 class="card-title">Carrito de Compras</h2>
          <span class="cart-count" *ngIf="cart.length > 0">{{ cart.length }} items</span>
        </div>

        <!-- Empty Cart State -->
        <div class="empty-cart" *ngIf="cart.length === 0">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="9" cy="21" r="1"></circle>
            <circle cx="20" cy="21" r="1"></circle>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
          </svg>
          <p>El carrito está vacío</p>
          <span>Agrega productos para comenzar la venta</span>
        </div>

        <!-- Cart Items -->
        <div class="cart-items" *ngIf="cart.length > 0">
          <div class="cart-item" *ngFor="let item of cart; let i = index">
            <div class="item-info">
              <h3 class="item-name">{{ item.product.name }}</h3>
              <p class="item-code">Código: {{ item.product.code }}</p>
              <span class="item-brand" *ngIf="item.product.brand">{{ item.product.brand }}</span>
            </div>
            <div class="item-controls">
              <div class="quantity-control">
                <input
                  type="number"
                  class="quantity-input-small"
                  [(ngModel)]="item.quantity"
                  (ngModelChange)="updateCartItemQuantity(item)"
                  min="1"
                  [max]="item.stock"
                />
                <span class="quantity-label">× ${{ item.product.sale_price | number:'1.2-2' }}</span>
              </div>
              <div class="item-actions">
                <span class="item-subtotal">${{ item.subtotal | number:'1.2-2' }}</span>
                <button class="remove-button" (click)="removeFromCart(i)">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Cart Summary -->
        <div class="cart-summary" *ngIf="cart.length > 0">
          <div class="summary-row">
            <span class="summary-label">Subtotal</span>
            <span class="summary-value">${{ total | number:'1.2-2' }}</span>
          </div>
          <div class="summary-row total-row">
            <span class="summary-label">Total</span>
            <span class="summary-value">${{ total | number:'1.2-2' }}</span>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="cart-actions" *ngIf="cart.length > 0">
          <button class="cancel-button" (click)="cancelSale()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
            Cancelar Venta
          </button>
          <button class="complete-button" (click)="completeSale()">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            Completar Venta
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
