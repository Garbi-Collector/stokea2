<div class="inicio-container">
  <!-- Pantalla cuando NO ha visitado (hasVisited = false) -->
  @if (!hasVisited) {
    <div class="first-visit-screen">
      <div class="welcome-message">
        <div class="icon-container">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
            <circle cx="12" cy="7" r="4"></circle>
          </svg>
        </div>
        <h2>¡Bienvenido!</h2>
        <p>Es tu primera vez aquí</p>
        <small>Se ha abierto un modal de configuración inicial para comenzar.</small>
      </div>
    </div>
  }

  <!-- Pantalla cuando YA ha visitado (hasVisited = true) -->
  @if (hasVisited) {
    <div class="dashboard-screen">
      <!-- Saludo personalizado -->
      <div class="greeting-header">
        <h1>{{ getGreeting() }}, {{ name || 'Usuario' }}!</h1>
      </div>

      <div class="cards-grid">
        <!-- Tarjeta de caja -->
        <!-- Tarjeta de caja con montos del día y acumulado -->
        <div class="cash-card">
          <div class="cash-header">
            <div class="cash-label">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
              </svg>
              <span>Efectivo en Caja</span>
            </div>
            <button class="toggle-visibility-btn" (click)="toggleCashVisibility()">
              @if (isCashVisible) {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path>
                  <line x1="1" y1="1" x2="23" y2="23"></line>
                </svg>
              }
            </button>
          </div>

          <!-- Monto del día -->
          <div class="cash-amount-section">
            <div class="amount-label">Recaudado hoy</div>
            <div class="cash-amount">
              @if (isCashVisible) {
                <span class="amount">$ {{ cashAmount | number:'1.2-2' }}</span>
              } @else {
                <span class="amount-hidden">••••••</span>
              }
            </div>
          </div>

          <!-- Divisor visual -->
          <div class="cash-divider"></div>

          <!-- Monto acumulado -->
          <div class="cash-amount-section accumulated">
            <div class="amount-label accumulated-label">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
              </svg>
              Total acumulado
            </div>
            <div class="cash-amount accumulated-amount">
              @if (isCashVisible) {
                <span class="amount-accumulated">$ {{ totalCashAmount | number:'1.2-2' }}</span>
              } @else {
                <span class="amount-hidden-small">••••••</span>
              }
            </div>
          </div>

          <div class="cash-actions">
            <button class="action-btn ingreso-btn" (click)="handleIngreso()">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <polyline points="19 12 12 19 5 12"></polyline>
              </svg>
              Ingreso
            </button>
            <button class="action-btn egreso-btn" (click)="handleEgreso()">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="19" x2="12" y2="5"></line>
                <polyline points="5 12 12 5 19 12"></polyline>
              </svg>
              Egreso
            </button>
          </div>
        </div>

        <!-- Tarjeta de calendario -->
        <div class="calendar-card">
          <div class="calendar-header">
            <div class="calendar-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
              </svg>
              <span>{{ currentMonth }} {{ currentYear }}</span>
            </div>
          </div>

          <div class="calendar-weekdays">
            @for (day of weekDays; track day) {
              <div class="weekday-header">{{ day }}</div>
            }
          </div>

          <div class="calendar-grid">
            @for (day of calendarDays; track day.date) {
              <div
                [ngClass]="getDayClasses(day)"
                [attr.data-day]="day.dayNumber">
                <span class="day-number">{{ day.dayNumber }}</span>
              </div>
            }
          </div>
        </div>

        <div class="goal-progress-card">
          <div class="goal-header">
            <div class="goal-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
              </svg>
              <span>Meta Diaria</span>
            </div>
            <div class="goal-target">
              <span class="goal-target-label">Objetivo:</span>
              <span class="goal-target-amount">$ {{ moneyGoal | number:'1.2-2' }}</span>
            </div>
          </div>

          @if (!isGoalReached) {
            <!-- Estado: No alcanzada la meta -->
            <div class="goal-content">
              <div class="goal-status pending">
                <div class="status-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"></circle>
                    <polyline points="12 6 12 12 16 14"></polyline>
                  </svg>
                </div>
                <div class="status-text">
                  <h3>En progreso</h3>
                  <p>Te faltan <strong>$ {{ remainingToGoal | number:'1.2-2' }}</strong> para alcanzar tu meta</p>
                </div>
              </div>

              <div class="progress-bar-container">
                <div class="progress-bar" [style.width.%]="goalProgress">
                  <span class="progress-percentage">{{ goalProgress | number:'1.0-0' }}%</span>
                </div>
              </div>

              <div class="goal-stats">
                <div class="stat-item">
                  <span class="stat-label">Recaudado</span>
                  <span class="stat-value">$ {{ salesAmount | number:'1.2-2' }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Falta</span>
                  <span class="stat-value remaining">$ {{ remainingToGoal | number:'1.2-2' }}</span>
                </div>
              </div>
            </div>
          } @else {
            <!-- Estado: Meta alcanzada -->
            <div class="goal-content achieved">
              <div class="goal-status achieved">
                <div class="status-icon achieved">
                  <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                  </svg>
                </div>
                <div class="status-text">
                  <h3>¡Meta alcanzada!</h3>
                  <p>Tienes <strong>$ {{ salesAmount | number:'1.2-2' }}</strong> recaudado hoy</p>
                  <p class="excess-info">Superaste tu meta por <strong>{{ goalExcessPercentage | number:'1.0-0' }}%</strong></p>
                </div>
              </div>

            @if (!isGoalReached) {
              <div class="progress-bar-container achieved">
                <div class="progress-bar achieved">
                  <span class="progress-percentage">100%</span>
                </div>
                @if (goalExcess > 0 ) {
                  <div class="progress-bar excess" [style.width.%]="Math.min(goalExcessPercentage, 100)">
                    <span class="progress-percentage">+{{ goalExcessPercentage | number:'1.0-0' }}%</span>
                  </div>
                }
              </div>
            }
              <div class="goal-stats achieved">
                <div class="stat-item">
                  <span class="stat-label">Recaudado</span>
                  <span class="stat-value success">$ {{ salesAmount | number:'1.2-2' }}</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Excedente</span>
                  <span class="stat-value success">$ {{ goalExcess | number:'1.2-2' }}</span>
                </div>
              </div>

              <div class="achievement-message">
                <p>¡Sigue así!</p>
              </div>
            </div>
          }
        </div>

      </div>
    </div>
  }
</div>

<!-- Componente modal -->
<app-modal></app-modal>
